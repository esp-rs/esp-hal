name: HIL (label)

on:
  pull_request_target:
    types: [labeled]

permissions:
  actions: write
  pull-requests: write
  contents: read

jobs:
  hil-quick:
    # Fire only when the added label is exactly quick-hil
    if: github.event.label.name == 'quick-hil'
    runs-on: ubuntu-latest
    steps:
      - name: Dispatch HIL (quick)
        uses: benc-uk/workflow-dispatch@v1
        with:
          workflow: HIL
          # run the workflow file from the default(main) branch
          ref: ${{ github.event.repository.default_branch }}
          inputs: |
            {
              "repository": "${{ github.repository }}",
              "branch": "refs/pull/${{ github.event.pull_request.number }}/head",
              "matrix": "quick"
            }

      - name: Confirm in PR
        uses: peter-evans/create-or-update-comment@v4
        with:
          issue-number: ${{ github.event.pull_request.number }}
          body: Label `quick-hil` detected — triggered **HIL** (`quick`) for \#${{ github.event.pull_request.number }}`.

      # auto-remove the label to avoid accidental re-triggers later
      - uses: actions-ecosystem/action-remove-labels@v1
        with:
          labels: quick-hil

  hil-full:
    if: github.event.label.name == 'full-hil'
    runs-on: ubuntu-latest
    steps:
      - name: Dispatch HIL (full)
        uses: benc-uk/workflow-dispatch@v1
        with:
          workflow: HIL
          ref: ${{ github.event.repository.default_branch }}
          inputs: |
            {
              "repository": "${{ github.repository }}",
              "branch": "refs/pull/${{ github.event.pull_request.number }}/head",
              "matrix": "full"
            }

      - name: Confirm in PR
        uses: peter-evans/create-or-update-comment@v4
        with:
          issue-number: ${{ github.event.pull_request.number }}
          body: Label `full-hil` detected — triggered **HIL** (`full`) for \#${{ github.event.pull_request.number }}`.

      # auto-remove the label
      - uses: actions-ecosystem/action-remove-labels@v1
        with:
          labels: full-hil
